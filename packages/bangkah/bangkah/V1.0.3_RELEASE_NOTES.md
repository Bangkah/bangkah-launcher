# Bangkah v1.0.3 Release Notes

**Release Date**: December 15, 2025

## üê≥ Docker Build Optimization

This release focuses on improving Docker build process and fixing package installation issues during containerization.

## üîß What's Fixed

### Docker Build Improvements
- **Fixed**: Composer removing `bangkah/bangkah` during Docker builds
- **Fixed**: Build failure when `composer.lock` doesn't exist
- **Improved**: Docker layer caching for faster subsequent builds
- **Improved**: Multi-stage build efficiency

### Technical Details

#### Problem
When building Docker images, Composer was removing `bangkah/bangkah` because:
1. Scaffolded projects don't have `bangkah/bangkah` in their `composer.json`
2. Docker was copying the entire project (including vendor) before running `composer install`
3. Composer detected packages that shouldn't exist and removed them

#### Solution
Changed Dockerfile generation to follow Docker best practices:

**Before:**
```dockerfile
COPY . .
RUN composer install --no-interaction
```

**After:**
```dockerfile
COPY composer.json ./
COPY composer.lock* ./
RUN composer install --no-interaction --no-dev --no-scripts
COPY . .
RUN composer dump-autoload --optimize
```

### Benefits

1. **Faster Builds**: Docker caching works better - dependency layer only rebuilds when composer files change
2. **Cleaner Process**: No more "Removing bangkah/bangkah" messages  
3. **More Reliable**: Handles missing `composer.lock` gracefully with wildcard copy
4. **Production-Ready**: Uses `--no-dev` flag for smaller images
5. **Better Separation**: Dependencies installed before copying application code

## üì¶ Installation

```bash
composer require bangkah/bangkah
```

Or upgrade existing installation:

```bash
composer update bangkah/bangkah
```

## üöÄ Usage

Create a new Laravel project with Docker:

```bash
php artisan bangkah:create --type=api --docker --nginx --yes
```

The generated Dockerfile now:
- ‚úÖ Builds without errors
- ‚úÖ Utilizes Docker layer caching efficiently  
- ‚úÖ Produces smaller, production-optimized images
- ‚úÖ Follows Docker best practices

## üìã Full Changelog

### Fixed
- Docker build removing bangkah/bangkah package during `composer install`
- Build failure when `composer.lock` file doesn't exist
- Inefficient Docker layer caching

### Changed
- Dockerfile now copies composer files before copying all files
- Added `composer.lock*` with wildcard to handle optional lock file
- Split `composer install` into two phases: install + dump-autoload
- Added `--no-dev --no-scripts` flags for production builds

### Technical Implementation
File: `src/Services/DockerService.php`
- Modified `generateDockerfile()` method
- Optimized both `php-cli` and `php-fpm` build stages
- Implemented proper dependency layer separation

## üîó Links

- **GitHub Repository**: https://github.com/Bangkah/bangkah
- **Packagist**: https://packagist.org/packages/bangkah/bangkah
- **Documentation**: See README.md for full documentation
- **Issues**: https://github.com/Bangkah/bangkah/issues

## üí° Migration Notes

If you're upgrading from v1.0.2:
1. Update the package: `composer update bangkah/bangkah`
2. Regenerate your Dockerfile if you're using Docker: `php artisan bangkah:create --docker`
3. Your existing projects continue to work - this only affects new scaffolding

## ‚ö†Ô∏è Breaking Changes

None - this is a patch release with bug fixes only.

## üôè Acknowledgments

Thanks to all users who reported the Docker build issues and helped identify the root cause.

---

**Previous Releases:**
- [v1.0.2](V1.0.2_RELEASE_NOTES.md) - Docker improvements and vendor fix
- [v1.0.1](CHANGELOG.md#v101) - Exclude-from-classmap fix
- [v1.0.0](CHANGELOG.md#v100) - Initial release
